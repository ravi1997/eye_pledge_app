{% extends "base.html" %}

{% block title %}Eye Donation Pledge - Step by Step{% endblock %}

{% block extra_css %}
<style>
    /* Custom checkmark animation or other small tweaks if needed */
    .animation-fade-up {
        animation: fadeUp 0.4s ease-out forwards;
    }

    @keyframes fadeUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="pb-8">
    <div class="text-center max-w-2xl mx-auto mb-10">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">{{ _('Eye Donation Pledge') }}</h1>
        <p class="text-slate-500 text-lg">
            {{ _('A few simple steps to leave a legacy of sight.') }}
        </p>
    </div>

    <div class="max-w-4xl mx-auto">
        <!-- Progress Indicator -->
        <div class="relative flex justify-between items-center mb-8 px-4 max-w-2xl mx-auto">
            <!-- Connecting Line -->
            <div class="absolute left-0 right-0 top-1/2 h-0.5 bg-slate-200 -z-10 -translate-y-1/2 mx-8"></div>

            {% for i in range(1, 5) %}
            <div class="step-item relative z-10 w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm transition-all duration-300 bg-slate-50 border-2 border-slate-200 text-slate-400"
                data-step="{{ i }}">
                {{ i }}
            </div>
            {% endfor %}
        </div>

        <div class="bg-white/80 backdrop-blur-xl border border-white/50 shadow-xl rounded-2xl p-6 md:p-8">
            <form method="POST" action="{{ url_for('pledge_form') }}" id="pledgeForm" novalidate>

                <!-- STEP 1: Personal Details -->
                <div class="form-step hidden animation-fade-up" data-step-index="1">
                    <h4 class="text-lg font-bold text-brand-600 mb-6 flex items-center gap-2">
                        <span
                            class="w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center text-brand-600 text-sm">1</span>
                        {{ _('Personal Information') }}
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-1">
                            <label for="donor_name" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Full
                                Name') }} <span class="text-red-500">*</span></label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                id="donor_name" name="donor_name" required>
                            <div class="validation-msg hidden text-xs text-red-500 mt-1">{{ _('Please enter your full
                                name.') }}</div>
                        </div>

                        <div class="col-span-1">
                            <label for="gender" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Gender')
                                }}</label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    id="gender" name="gender">
                                    <option value="">{{ _('Select Gender') }}</option>
                                    <option value="Male">{{ _('Male') }}</option>
                                    <option value="Female">{{ _('Female') }}</option>
                                    <option value="Other">{{ _('Other') }}</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-span-1">
                            <label for="marital_status" class="block text-sm font-bold text-slate-800 mb-2">{{
                                _('Marital Status') }}</label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    id="marital_status" name="marital_status">
                                    <option value="">{{ _('Select Status') }}</option>
                                    <option value="Single">{{ _('Single') }}</option>
                                    <option value="Married">{{ _('Married') }}</option>
                                    <option value="Divorced">{{ _('Divorced') }}</option>
                                    <option value="Widowed">{{ _('Widowed') }}</option>
                                    <option value="Other">{{ _('Other') }}</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-span-1">
                            <label for="occupation" class="block text-sm font-bold text-slate-800 mb-2">{{
                                _('Occupation') }}</label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                id="occupation" name="occupation" placeholder="{{ _('e.g. Engineer, Student') }}">
                        </div>

                        <div class="col-span-1 md:col-span-1">
                            <!-- 1/3 in pure grid needs customized classes, sticking to 1/2 for simplicity or using 1/3 if needed -->
                            <!-- Actually bootstrap used col-md-4 (1/3). Let's use flex or specific col span if we want 3 columns -->
                        </div>
                    </div>

                    <!-- 3 Column Row -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <div class="col-span-1">
                            <label for="date_of_birth" class="block text-sm font-bold text-slate-800 mb-2">{{
                                _('Date of Birth') }}</label>
                            <input type="date"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all"
                                id="date_of_birth" name="date_of_birth">
                        </div>
                        <div class="col-span-1">
                            <label for="age" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Age')
                                }}</label>
                            <input type="number"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-100 text-slate-500 shadow-inner focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all cursor-not-allowed"
                                id="age" name="age" min="1" max="120" readonly>
                            <small class="text-slate-400 text-xs">{{ _('Auto-calculated') }}</small>
                        </div>
                        <div class="col-span-1">
                            <label for="blood_group" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Blood
                                Group') }}</label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    id="blood_group" name="blood_group">
                                    <option value="">{{ _('Select Group') }}</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6">
                        <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('ID Proof (Indian
                            Standard)') }} <span class="text-red-500">*</span></label>
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="relative w-full md:w-1/3">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    name="id_proof_type">
                                    <option value="Aadhaar">Aadhaar</option>
                                    <option value="PAN">PAN</option>
                                    <option value="Voter ID">Voter ID</option>
                                    <option value="Driving License">Driving License</option>
                                    <option value="Passport">Passport</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="id_proof_number" placeholder="{{ _('Enter ID Number') }}" required>
                        </div>
                    </div>

                    <div class="mt-8 text-right">
                        <button type="button"
                            class="btn-next px-6 py-2.5 bg-brand-600 hover:bg-brand-700 text-white font-semibold rounded-xl shadow-lg shadow-brand-500/30 transition-all inline-flex items-center gap-2">
                            {{ _('Next Step') }} <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 2: Address & Contact -->
                <div class="form-step hidden animation-fade-up" data-step-index="2">
                    <h4 class="text-lg font-bold text-brand-600 mb-6 flex items-center gap-2">
                        <span
                            class="w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center text-brand-600 text-sm">2</span>
                        {{ _('Contact & Address') }}
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-1">
                            <label for="donor_mobile" class="block text-sm font-bold text-slate-800 mb-2">{{
                                _('Mobile Number') }} <span class="text-red-500">*</span></label>
                            <div class="flex rounded-xl shadow-sm">
                                <span
                                    class="inline-flex items-center px-4 py-3 rounded-l-xl border border-r-0 border-slate-300 bg-slate-50 text-slate-600 font-medium text-sm">+91</span>
                                <input type="tel"
                                    class="flex-1 block w-full px-4 py-3 rounded-none rounded-r-xl border border-slate-300 bg-white text-slate-900 focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                    id="donor_mobile" name="donor_mobile" pattern="[0-9]{10}"
                                    placeholder="{{ _('10-digit number') }}" required>
                            </div>

                            <div class="validation-msg hidden text-xs text-red-500 mt-1">{{ _('Enter a valid 10-digit
                                mobile number.') }}</div>
                        </div>

                        <div class="col-span-1">
                            <label for="donor_email" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Email
                                Address') }}</label>
                            <input type="email"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                id="donor_email" name="donor_email" placeholder="name@example.com">
                        </div>

                        <div class="col-span-2">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Address Line 1') }}
                                <span class="text-red-500">*</span></label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="address_line1" required>
                        </div>

                        <div class="col-span-2">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Address Line 2')
                                }}</label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="address_line2" placeholder="{{ _('Apartment, Studio, or Floor') }}">
                        </div>

                        <div class="col-span-1">
                            <label for="state" class="block text-sm font-bold text-slate-800 mb-2">{{ _('State /
                                UT') }} <span class="text-red-500">*</span></label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    id="state" name="state" required>
                                    <option value="">{{ _('Select State') }}</option>
                                    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                    <option value="Assam">Assam</option>
                                    <option value="Bihar">Bihar</option>
                                    <option value="Chandigarh">Chandigarh</option>
                                    <option value="Chhattisgarh">Chhattisgarh</option>
                                    <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and
                                        Daman and Diu</option>
                                    <option value="Delhi">Delhi</option>
                                    <option value="Goa">Goa</option>
                                    <option value="Gujarat">Gujarat</option>
                                    <option value="Haryana">Haryana</option>
                                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                                    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                    <option value="Jharkhand">Jharkhand</option>
                                    <option value="Karnataka">Karnataka</option>
                                    <option value="Kerala">Kerala</option>
                                    <option value="Ladakh">Ladakh</option>
                                    <option value="Lakshadweep">Lakshadweep</option>
                                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                                    <option value="Maharashtra">Maharashtra</option>
                                    <option value="Manipur">Manipur</option>
                                    <option value="Meghalaya">Meghalaya</option>
                                    <option value="Mizoram">Mizoram</option>
                                    <option value="Nagaland">Nagaland</option>
                                    <option value="Odisha">Odisha</option>
                                    <option value="Puducherry">Puducherry</option>
                                    <option value="Punjab">Punjab</option>
                                    <option value="Rajasthan">Rajasthan</option>
                                    <option value="Sikkim">Sikkim</option>
                                    <option value="Tamil Nadu">Tamil Nadu</option>
                                    <option value="Telangana">Telangana</option>
                                    <option value="Tripura">Tripura</option>
                                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                                    <option value="Uttarakhand">Uttarakhand</option>
                                    <option value="West Bengal">West Bengal</option>
                                    <option value="Other">Other</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('City') }} <span
                                    class="text-red-500">*</span></label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="city" required>
                        </div>

                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('District') }}</label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="district">
                        </div>

                        <div class="col-span-1 md:col-span-1">
                            <!-- Using grid gap to align -->
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Pincode') }} <span
                                    class="text-red-500">*</span></label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="pincode" pattern="[0-9]{6}" placeholder="{{ _('6-digit code') }}" required>
                        </div>
                    </div>

                    <div class="mt-8 flex justify-between">
                        <button type="button"
                            class="btn-prev px-6 py-2.5 border border-slate-300 text-slate-600 font-semibold rounded-xl hover:bg-slate-50 transition-all inline-flex items-center gap-2">
                            <i class="bi bi-arrow-left"></i> {{ _('Previous') }}
                        </button>
                        <button type="button"
                            class="btn-next px-6 py-2.5 bg-brand-600 hover:bg-brand-700 text-white font-semibold rounded-xl shadow-lg shadow-brand-500/30 transition-all inline-flex items-center gap-2">
                            {{ _('Next Step') }} <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 3: Witness (Next of Kin) -->
                <div class="form-step hidden animation-fade-up" data-step-index="3">
                    <h4 class="text-lg font-bold text-brand-600 mb-6 flex items-center gap-2">
                        <span
                            class="w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center text-brand-600 text-sm">3</span>
                        {{ _('Next of Kin / Witness') }}
                    </h4>

                    <div class="p-4 rounded-xl bg-blue-50 border border-blue-100 text-blue-800 text-sm mb-6 flex gap-3">
                        <i class="bi bi-info-circle-fill mt-0.5 shrink-0"></i>
                        {{ _('A witness (preferably next of kin) is mandatory for the pledge to be registered.') }}
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Witness Name') }} <span
                                    class="text-red-500">*</span></label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="witness1_name" required>
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Relationship') }} <span
                                    class="text-red-500">*</span></label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    name="witness1_relationship" required>
                                    <option value="">{{ _('Select Relationship') }}</option>
                                    <option value="Father">{{ _('Father') }}</option>
                                    <option value="Mother">{{ _('Mother') }}</option>
                                    <option value="Spouse">{{ _('Spouse') }}</option>
                                    <option value="Child">{{ _('Child') }}</option>
                                    <option value="Sibling">{{ _('Sibling') }}</option>
                                    <option value="Friend">{{ _('Friend') }}</option>
                                    <option value="Other">{{ _('Other') }}</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Witness Mobile') }}
                                <span class="text-red-500">*</span></label>
                            <div class="flex rounded-xl shadow-sm">
                                <span
                                    class="inline-flex items-center px-4 py-3 rounded-l-xl border border-r-0 border-slate-300 bg-slate-50 text-slate-600 font-medium text-sm">+91</span>
                                <input type="tel"
                                    class="flex-1 block w-full px-4 py-3 rounded-none rounded-r-xl border border-slate-300 bg-white text-slate-900 focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                    name="witness1_mobile" pattern="[0-9]{10}" required>
                            </div>
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Witness Email')
                                }}</label>
                            <input type="email"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="witness1_email">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Witness Address')
                                }}</label>
                            <textarea
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="witness1_address" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="border-t border-slate-200 my-8"></div>

                    <h5 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">{{ _('Second Witness
                        (Optional)') }}</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 opacity-80 hover:opacity-100 transition-opacity">
                        <!-- Same structure as witness 1 but optional -->
                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Witness Name')
                                }}</label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="witness2_name">
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Relationship')
                                }}</label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    name="witness2_relationship">
                                    <option value="">{{ _('Select Relationship') }}</option>
                                    <option value="Father">{{ _('Father') }}</option>
                                    <!-- ... -->
                                    <option value="Other">{{ _('Other') }}</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Witness Mobile')
                                }}</label>
                            <div class="flex rounded-xl shadow-sm">
                                <span
                                    class="inline-flex items-center px-4 py-3 rounded-l-xl border border-r-0 border-slate-300 bg-slate-50 text-slate-600 font-medium text-sm">+91</span>
                                <input type="tel"
                                    class="flex-1 block w-full px-4 py-3 rounded-none rounded-r-xl border border-slate-300 bg-white text-slate-900 focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                    name="witness2_mobile" pattern="[0-9]{10}">
                            </div>
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Witness Email')
                                }}</label>
                            <input type="email"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="witness2_email">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Witness Address')
                                }}</label>
                            <textarea
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="witness2_address" rows="1"></textarea>
                        </div>
                    </div>

                    <div class="mt-8 flex justify-between">
                        <button type="button"
                            class="btn-prev px-6 py-2.5 border border-slate-300 text-slate-600 font-semibold rounded-xl hover:bg-slate-50 transition-all inline-flex items-center gap-2">
                            <i class="bi bi-arrow-left"></i> {{ _('Previous') }}
                        </button>
                        <button type="button"
                            class="btn-next px-6 py-2.5 bg-brand-600 hover:bg-brand-700 text-white font-semibold rounded-xl shadow-lg shadow-brand-500/30 transition-all inline-flex items-center gap-2">
                            {{ _('Next Step') }} <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 4: Pledge & Consent -->
                <div class="form-step hidden animation-fade-up" data-step-index="4">
                    <h4 class="text-lg font-bold text-brand-600 mb-6 flex items-center gap-2">
                        <span
                            class="w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center text-brand-600 text-sm">4</span>
                        {{ _('Final Consent') }}
                    </h4>

                    <div class="bg-slate-50 border border-slate-200 rounded-xl p-6 mb-6">
                        <h5 class="text-lg font-bold text-slate-900 mb-4">{{ _('My Wish') }}</h5>

                        <div class="mb-4">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('I wish to donate:')
                                }}</label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    name="organs_consented">
                                    <option value="Both eyes" selected>{{ _('Both Eyes (Recommended)') }}</option>
                                    <option value="Cornea only">{{ _('Corneas Only') }}</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Place of Pledge')
                                    }}</label>
                                <input type="text"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                    name="place" placeholder="e.g. Mumbai">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Preferred Eye Bank
                                    (Optional)') }}</label>
                                <input type="text"
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                    name="preferred_eye_bank">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('Additional Notes')
                                }}</label>
                            <textarea
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="additional_notes" rows="2"></textarea>
                        </div>

                        <p class="text-xs text-slate-500 italic mt-2">
                            {{ _('By submitting this form, I hereby pledge to donate my eyes after my death...') }}
                            {{ _('I understand my family will be the final authority...') }}
                        </p>
                    </div>

                    <div class="space-y-4 mb-8">
                        <div class="flex items-start gap-3">
                            <input type="checkbox"
                                class="form-checkbox mt-1 w-5 h-5 text-brand-600 rounded border-slate-300 focus:ring-brand-500"
                                id="consent_check" name="donor_consent" required>
                            <label class="text-sm text-slate-700 font-bold" for="consent_check">
                                {{ _('I solemnly Pledge to donate my eyes.') }} <span class="text-red-500">*</span>
                            </label>
                        </div>

                        <div class="flex items-start gap-3">
                            <input type="checkbox"
                                class="form-checkbox mt-1 w-5 h-5 text-brand-600 rounded border-slate-300 focus:ring-brand-500"
                                name="acknowledged_revocability" checked>
                            <label class="text-sm text-slate-600">
                                {{ _('I understand this pledge is voluntary and can be revoked at any time.') }}
                            </label>
                        </div>

                        <div class="flex items-start gap-3">
                            <input type="checkbox"
                                class="form-checkbox mt-1 w-5 h-5 text-brand-600 rounded border-slate-300 focus:ring-brand-500"
                                id="dpdp_consent" name="dpdp_consent" required>
                            <label class="text-sm text-slate-600" for="dpdp_consent">
                                {{ _('I hereby give my consent for the collection and processing of my personal data for
                                the purpose of eye donation pledging, in compliance with the Digital Personal Data
                                Protection (DPDP) Act, 2023.') }} <span class="text-red-500">*</span>
                            </label>
                        </div>
                    </div>

                    <!-- Hidden Date Field -->
                    <input type="hidden" name="date_of_pledge" id="date_of_pledge">

                    <div class="flex justify-between items-center">
                        <button type="button"
                            class="btn-prev px-6 py-2.5 border border-slate-300 text-slate-600 font-semibold rounded-xl hover:bg-slate-50 transition-all inline-flex items-center gap-2">
                            <i class="bi bi-arrow-left"></i> {{ _('Previous') }}
                        </button>
                        <button type="submit"
                            class="px-8 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl shadow-lg shadow-green-600/30 transition-all transform hover:-translate-y-0.5 inline-flex items-center gap-2">
                            <i class="bi bi-heart-fill"></i> {{ _('Confirm Pledge') }}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- DPDP Consent Modal -->
<div id="dpdpConsentModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
    aria-modal="true">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-slate-900/60 transition-opacity backdrop-blur-sm"></div>

    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">

            <div
                class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-4xl border border-slate-200">

                <!-- Header -->
                <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
                    <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2" id="modal-title">
                        <i class="bi bi-shield-check text-brand-600"></i>
                        {{ _('Terms of Service & Privacy Policy') }}
                    </h3>
                    <button type="button" class="btn-close-modal text-slate-400 hover:text-slate-600 transition-colors">
                        <span class="sr-only">Close</span>
                        <i class="bi bi-x-lg text-lg"></i>
                    </button>
                </div>

                <!-- Scrollable Content -->
                <div
                    class="px-6 py-6 max-h-[60vh] overflow-y-auto custom-scrollbar text-slate-700 text-sm leading-relaxed space-y-4">
                    <section id="dpdp-consent-eye-donation" style="font-family: Arial, sans-serif; line-height: 1.4;">
                        <h3 style="margin: 0 0 8px 0;">Consent for Collection and Use of Personal Data (Voluntary Eye
                            Donation Pledge)</h3>

                        <p>
                            I hereby voluntarily pledge to donate my eyes after death for therapeutic purposes, in
                            accordance with the provisions
                            of the <strong>Transplantation of Human Organs and Tissues Act (THOTA), 1994 and Rules
                                thereunder</strong>, and I provide my
                            consent for the collection and use of my personal data as described below.
                        </p>

                        <h4 style="margin: 12px 0 6px 0;">Purpose of Data Collection</h4>
                        <p>
                            I understand that the personal information provided by me is collected solely for the
                            purpose of:
                        </p>
                        <ul style="margin-top: 6px; list-style-type: disc; padding-left: 20px;">
                            <li>Registering and maintaining my eye donation pledge</li>
                            <li>Enabling timely coordination of eye donation by the Eye Bank after my death</li>
                            <li>Contacting my next of kin or authorised representative, when required</li>
                            <li>Fulfilling statutory, ethical, and operational requirements under the National Organ
                                &amp; Tissue Transplant Programme</li>
                        </ul>

                        <h4 style="margin: 12px 0 6px 0;">Nature of Data Collected</h4>
                        <p>I understand that the information collected may include:</p>
                        <ul style="margin-top: 6px; list-style-type: disc; padding-left: 20px;">
                            <li>Personal and contact details</li>
                            <li>Details of next of kin or family contact</li>
                            <li>Limited medical information relevant to eye donation suitability</li>
                        </ul>

                        <h4 style="margin: 12px 0 6px 0;">Data Access, Confidentiality, and De-identified Use</h4>
                        <p>I understand and agree that:</p>
                        <ul style="margin-top: 6px; list-style-type: disc; padding-left: 20px;">
                            <li>My <strong>identifiable personal data shall be kept strictly confidential</strong>.</li>
                            <li>Access to my identifiable data shall be <strong>restricted only to authorised personnel
                                    of the Eye Bank</strong> for purposes related to eye donation.</li>
                            <li>My identifiable personal data <strong>shall not be disclosed</strong> to any other
                                individual or organisation, except as required under law.</li>
                        </ul>

                        <p>I further understand that:</p>
                        <ul style="margin-top: 6px; list-style-type: disc; padding-left: 20px;">
                            <li>
                                <strong>De-identified or anonymised data</strong>, from which all personally
                                identifiable information has been removed,
                                may be used by the Eye Bank for <strong>legitimate operational purposes</strong>,
                                including:
                                <ul style="margin-top: 6px; list-style-type: circle; padding-left: 20px;">
                                    <li>Eye bank activity reporting</li>
                                    <li>Quality assurance and audit</li>
                                    <li>Submission of aggregated statistics to appropriate authorities</li>
                                </ul>
                            </li>
                            <li>
                                Such de-identified data shall not be used to identify me and shall not be used for
                                commercial or promotional purposes.
                            </li>
                        </ul>

                        <h4 style="margin: 12px 0 6px 0;">Data Storage and Retention</h4>
                        <ul style="margin-top: 6px; list-style-type: disc; padding-left: 20px;">
                            <li>My data will be stored securely in physical and/or electronic records maintained by the
                                Eye Bank.</li>
                            <li>Reasonable safeguards will be adopted to prevent unauthorised access, misuse, or
                                disclosure.</li>
                            <li>My identifiable data will be retained only for as long as required for eye
                                donationâ€“related purposes or as mandated by applicable laws.</li>
                        </ul>

                        <h4 style="margin: 12px 0 6px 0;">Rights of the Donor (Data Principal)</h4>
                        <p>
                            I am aware that, in accordance with applicable law including the <strong>Digital Personal
                                Data Protection Act, 2023</strong>,
                            I have the right to:
                        </p>
                        <ul style="margin-top: 6px; list-style-type: disc; padding-left: 20px;">
                            <li>Seek correction or updating of my personal information</li>
                            <li>Withdraw my eye donation pledge at any time during my lifetime by informing the Eye Bank
                            </li>
                            <li>Raise concerns or grievances regarding the handling of my personal data</li>
                        </ul>

                        <h4 style="margin: 12px 0 6px 0;">Withdrawal of Consent</h4>
                        <p>I understand that I may withdraw this pledge and my consent at any time during my lifetime.
                            Upon such withdrawal:</p>
                        <ul style="margin-top: 6px; list-style-type: disc; padding-left: 20px;">
                            <li>My identifiable personal data shall no longer be used for eye donation purposes</li>
                            <li>De-identified data already generated may continue to be used for legitimate operational
                                and reporting purposes</li>
                            <li>Data may be retained where required under applicable laws</li>
                        </ul>

                        <h4 style="margin: 12px 0 6px 0;">Declaration</h4>
                        <p>
                            I confirm that:
                        </p>
                        <ul style="margin-top: 6px; list-style-type: disc; padding-left: 20px;">
                            <li>This pledge is made voluntarily and without any coercion</li>
                            <li>I have read and understood the above information</li>
                            <li>
                                I provide my <strong>free, informed, specific, and unambiguous consent</strong> for the
                                collection, storage, and use of
                                my personal data by the Eye Bank for purposes related to eye donation, in accordance
                                with applicable laws
                            </li>
                        </ul>

                        <p style="margin-top: 10px;">
                            <em>
                                This pledge is an expression of my wish and shall be honoured to the extent permissible
                                under law and subject to the
                                consent of my family or next of kin at the time of death.
                            </em>
                        </p>

                        <hr style="margin: 14px 0;" />

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px;">
                            <div>
                                <label for="consent_donor_name"><strong>Name of Donor:</strong></label><br />
                                <input id="consent_donor_name" type="text"
                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"
                                    readonly />
                            </div>

                            <div>
                                <label for="consent_date_display"><strong>Date:</strong></label><br />
                                <input id="consent_date_display" type="date"
                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"
                                    readonly />
                            </div>

                            <div>
                                <label for="donor_signature"><strong>Signature / Thumb
                                        Impression:</strong></label><br />
                                <input id="donor_signature" type="text" placeholder="Type name to sign"
                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" />
                            </div>

                            <div>
                                <label for="eye_bank_name_display"><strong>Name and Address of Eye
                                        Bank:</strong></label><br />
                                <input id="eye_bank_name_display" type="text" value="AIIMS Eye Bank, New Delhi"
                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"
                                    readonly />
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Footer -->
                <div
                    class="bg-gray-50 px-6 py-4 border-t border-slate-100 flex flex-col-reverse sm:flex-row sm:justify-end gap-3 rounded-b-2xl">
                    <button type="button"
                        class="btn-close-modal w-full sm:w-auto px-5 py-2.5 rounded-xl border border-slate-300 text-slate-700 font-semibold hover:bg-slate-50 transition-colors">
                        {{ _('Cancel') }}
                    </button>
                    <button type="button" id="btn-agree-consent"
                        class="w-full sm:w-auto px-6 py-2.5 rounded-xl bg-brand-600 text-white font-bold hover:bg-brand-700 shadow-lg shadow-brand-500/20 transition-all flex items-center justify-center gap-2">
                        <i class="bi bi-check-lg"></i>
                        {{ _('I Agree & Accept') }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script for styling scrollbar -->
<style>
    .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f5f9;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const steps = document.querySelectorAll('.form-step');
        const indicators = document.querySelectorAll('.step-item');
        let currentStep = 0;

        // Init visibility
        updateUI();

        // Set today's date
        document.getElementById('date_of_pledge').value = new Date().toISOString().split('T')[0];

        // Age Calculation
        const dobInput = document.getElementById('date_of_birth');
        const ageInput = document.getElementById('age');
        dobInput.addEventListener('change', function () {
            if (this.value) {
                const dob = new Date(this.value);
                const today = new Date();
                let age = today.getFullYear() - dob.getFullYear();
                const m = today.getMonth() - dob.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                    age--;
                }
                ageInput.value = age;
            }
        });

        // Validations
        function validateStep(index) {
            const step = steps[index];
            const inputs = step.querySelectorAll('input[required], select[required]');
            let valid = true;

            inputs.forEach(input => {
                const msg = input.parentElement.querySelector('.validation-msg') || input.parentElement.parentElement.querySelector('.validation-msg');

                if (!input.checkValidity()) {
                    input.reportValidity();
                    valid = false;
                    // Tailwind error styling
                    input.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                    if (msg) msg.classList.remove('hidden');
                } else {
                    input.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                    if (msg) msg.classList.add('hidden');
                }
            });
            return valid;
        }

        // Navigation
        document.querySelectorAll('.btn-next').forEach(btn => {
            btn.addEventListener('click', () => {
                if (validateStep(currentStep)) {
                    if (currentStep < steps.length - 1) {
                        currentStep++;
                        updateUI();
                    }
                }
            });
        });

        document.querySelectorAll('.btn-prev').forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    updateUI();
                }
            });
        });

        function updateUI() {
            // Update Steps Visibility
            steps.forEach((step, idx) => {
                if (idx === currentStep) {
                    step.classList.remove('hidden');
                } else {
                    step.classList.add('hidden');
                }
            });

            // Update Indicators
            indicators.forEach((ind, idx) => {
                // Reset classes
                ind.className = 'step-item relative z-10 w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm transition-all duration-300 border-2';

                if (idx === currentStep) {
                    // Active (Brand Blue)
                    ind.classList.add('bg-brand-600', 'border-brand-600', 'text-white', 'shadow-[0_0_0_4px_rgba(37,99,235,0.2)]');
                    ind.innerHTML = idx + 1;
                } else if (idx < currentStep) {
                    // Completed (Green)
                    ind.classList.add('bg-green-500', 'border-green-500', 'text-white');
                    ind.innerHTML = '<i class="bi bi-check-lg"></i>';
                } else {
                    // Inactive (Gray)
                    ind.classList.add('bg-slate-50', 'border-slate-200', 'text-slate-400');
                    ind.innerHTML = idx + 1;
                }
            });

            // Scroll to top of form
            const formContainer = document.querySelector('.max-w-4xl');
            if (formContainer) {
                const y = formContainer.getBoundingClientRect().top + window.scrollY - 100;
                window.scrollTo({ top: y, behavior: 'smooth' });
            }
        }

        // --- DPDP Consent Modal Logic ---
        const dpdpCheckbox = document.getElementById('dpdp_consent');
        const consentModal = document.getElementById('dpdpConsentModal');
        const btnAgree = document.getElementById('btn-agree-consent');
        const closeButtons = document.querySelectorAll('.btn-close-modal');

        // Inputs inside the modal to auto-fill
        const consentDonorName = document.getElementById('consent_donor_name');
        const consentDateDisplay = document.getElementById('consent_date_display');
        const mainDonorNameInput = document.getElementById('donor_name');

        function showModal() {
            consentModal.classList.remove('hidden');
            // Auto-fill details from the main form
            if (mainDonorNameInput && consentDonorName) {
                consentDonorName.value = mainDonorNameInput.value;
            }
            if (consentDateDisplay) {
                consentDateDisplay.value = new Date().toISOString().split('T')[0];
            }
            // Lock body scroll
            document.body.style.overflow = 'hidden';
        }

        function hideModal() {
            consentModal.classList.add('hidden');
            // Unlock body scroll
            document.body.style.overflow = '';
        }

        // 1. Intercept Checkbox Click
        if (dpdpCheckbox) {
            dpdpCheckbox.addEventListener('click', function (e) {
                if (this.checked) {
                    e.preventDefault(); // Stop it from checking immediately
                    showModal();
                } else {
                    // If unchecking, just let it uncheck. 
                    // Or if you want to confirm unchecking, you can add logic here.
                }
            });
        }

        // 2. Handle "I Agree"
        if (btnAgree) {
            btnAgree.addEventListener('click', function () {
                if (dpdpCheckbox) {
                    dpdpCheckbox.checked = true;
                    // Trigger change event if needed for validation
                    const event = new Event('change');
                    dpdpCheckbox.dispatchEvent(event);
                }
                hideModal();
            });
        }

        // 3. Handle Cancel / Close
        closeButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                // Checkbox remains unchecked (or user unchecks it if it was somehow checked)
                if (dpdpCheckbox) {
                    dpdpCheckbox.checked = false;
                }
                hideModal();
            });
        });

        // Close on click outside (Backdrop)
        if (consentModal) {
            // The modal container is the fixed inset-0 div with z-50.
            // The backdrop is the first child.
            consentModal.querySelector('.fixed.inset-0.bg-slate-900\\/60').addEventListener('click', function () {
                // Checkbox remains unchecked
                if (dpdpCheckbox) {
                    dpdpCheckbox.checked = false;
                }
                hideModal();
            });
        }

    });
</script>
{% endblock %}