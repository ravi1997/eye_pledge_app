{% extends "base.html" %}

{% block title %}Eye Donation Pledge - Step by Step{% endblock %}

{% block extra_css %}
<style>
    /* Custom checkmark animation or other small tweaks if needed */
    .animation-fade-up {
        animation: fadeUp 0.4s ease-out forwards;
    }

    @keyframes fadeUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="pb-8">
    <div class="text-center max-w-2xl mx-auto mb-10">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">{{ _('Eye Donation Pledge') }}</h1>
        <p class="text-slate-500 text-lg">
            {{ _('A few simple steps to leave a legacy of sight.') }}
        </p>
    </div>

    <div class="max-w-4xl mx-auto">
        <!-- Progress Indicator -->
        <div class="relative flex justify-between items-center mb-8 px-4 max-w-2xl mx-auto">
            <!-- Connecting Line -->
            <div class="absolute left-0 right-0 top-1/2 h-0.5 bg-slate-200 -z-10 -translate-y-1/2 mx-8"></div>

            {% for i in range(1, 5) %}
            <div class="step-item relative z-10 w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm transition-all duration-300 bg-slate-50 border-2 border-slate-200 text-slate-400"
                data-step="{{ i }}">
                {{ i }}
            </div>
            {% endfor %}
        </div>

        <div class="bg-white/80 backdrop-blur-xl border border-white/50 shadow-xl rounded-2xl p-6 md:p-8">
            <form method="POST" action="{{ url_for('pledge_form') }}" id="pledgeForm" novalidate>

                <!-- STEP 1: Personal Details -->
                <div class="form-step hidden animation-fade-up" data-step-index="1">
                    <h4 class="text-lg font-bold text-brand-600 mb-6 flex items-center gap-2">
                        <span
                            class="w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center text-brand-600 text-sm">1</span>
                        {{ _('Personal Information') }}
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-1">
                            <label for="donor_name" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Full
                                Name') }} <span class="text-red-500">*</span></label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                id="donor_name" name="donor_name" required>
                            <div class="validation-msg hidden text-xs text-red-500 mt-1">{{ _('Please enter your full
                                name.') }}</div>
                        </div>

                        <div class="col-span-1">
                            <label for="gender" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Gender')
                                }}</label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    id="gender" name="gender">
                                    <option value="">{{ _('Select Gender') }}</option>
                                    <option value="Male">{{ _('Male') }}</option>
                                    <option value="Female">{{ _('Female') }}</option>
                                    <option value="Other">{{ _('Other') }}</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-span-1">
                            <label for="marital_status" class="block text-sm font-bold text-slate-800 mb-2">{{
                                _('Marital Status') }}</label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    id="marital_status" name="marital_status">
                                    <option value="">{{ _('Select Status') }}</option>
                                    <option value="Single">{{ _('Single') }}</option>
                                    <option value="Married">{{ _('Married') }}</option>
                                    <option value="Divorced">{{ _('Divorced') }}</option>
                                    <option value="Widowed">{{ _('Widowed') }}</option>
                                    <option value="Other">{{ _('Other') }}</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <div class="col-span-1">
                            <label for="occupation" class="block text-sm font-bold text-slate-800 mb-2">{{
                                _('Occupation') }}</label>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                id="occupation" name="occupation" placeholder="{{ _('e.g. Engineer, Student') }}">
                        </div>

                        <div class="col-span-1 md:col-span-1">
                            <!-- 1/3 in pure grid needs customized classes, sticking to 1/2 for simplicity or using 1/3 if needed -->
                            <!-- Actually bootstrap used col-md-4 (1/3). Let's use flex or specific col span if we want 3 columns -->
                        </div>
                    </div>

                    <!-- 3 Column Row -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <div class="col-span-1">
                            <label for="date_of_birth" class="block text-sm font-bold text-slate-800 mb-2">{{
                                _('Date of Birth') }}</label>
                            <input type="date"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all"
                                id="date_of_birth" name="date_of_birth">
                        </div>
                        <div class="col-span-1">
                            <label for="age" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Age')
                                }}</label>
                            <input type="number"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-100 text-slate-500 shadow-inner focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all cursor-not-allowed"
                                id="age" name="age" min="1" max="120" readonly>
                            <small class="text-slate-400 text-xs">{{ _('Auto-calculated') }}</small>
                        </div>
                        <div class="col-span-1">
                            <label for="blood_group" class="block text-sm font-bold text-slate-800 mb-2">{{ _('Blood
                                Group') }}</label>
                            <div class="relative">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    id="blood_group" name="blood_group">
                                    <option value="">{{ _('Select Group') }}</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6">
                        <label class="block text-sm font-bold text-slate-800 mb-2">{{ _('ID Proof (Indian
                            Standard)') }} <span class="text-red-500">*</span></label>
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="relative w-full md:w-1/3">
                                <select
                                    class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all appearance-none cursor-pointer"
                                    name="id_proof_type">
                                    <option value="Aadhaar">Aadhaar</option>
                                    <option value="PAN">PAN</option>
                                    <option value="Voter ID">Voter ID</option>
                                    <option value="Driving License">Driving License</option>
                                    <option value="Passport">Passport</option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                    <i class="bi bi-chevron-down text-xs"></i>
                                </div>
                            </div>
                            <input type="text"
                                class="w-full px-4 py-3 rounded-xl border border-slate-300 bg-white text-slate-900 shadow-sm focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                name="id_proof_number" placeholder="{{ _('Enter ID Number') }}" required>
                        </div>
                    </div>

                    <div class="mt-8 text-right">
                        <button type="button"
                            class="btn-next px-6 py-2.5 bg-brand-600 hover:bg-brand-700 text-white font-semibold rounded-xl shadow-lg shadow-brand-500/30 transition-all inline-flex items-center gap-2">
                            {{ _('Next Step') }} <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 2: Address & Contact -->
                <div class="form-step hidden animation-fade-up" data-step-index="2">
                    <h4 class="text-lg font-bold text-brand-600 mb-6 flex items-center gap-2">
                        <span
                            class="w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center text-brand-600 text-sm">2</span>
                        {{ _('Contact & Address') }}
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-1">
                            <label for="donor_mobile" class="block text-sm font-bold text-slate-800 mb-2">{{
                                _('Mobile Number') }} <span class="text-red-500">*</span></label>
                            <div class="flex rounded-xl shadow-sm">
                                <span
                                    class="inline-flex items-center px-4 py-3 rounded-l-xl border border-r-0 border-slate-300 bg-slate-50 text-slate-600 font-medium text-sm">+91</span>
                                <input type="tel"
                                    class="flex-1 block w-full px-4 py-3 rounded-none rounded-r-xl border border-slate-300 bg-white text-slate-900 focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition-all placeholder:text-slate-400"
                                    id="donor_mobile" name="donor_mobile" pattern="[0-9]{10}"
                                    placeholder="{{ _('10-digit number') }}" required>
                            </div>
                        </div>
                        <div class="validation-msg hidden text-xs text-red-500 mt-1">{{ _('Enter a valid 10-digit
                            mobile number.') }}</div>
                    </div>

                    <div class="col-span-1">
                        <label for="donor_email" class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Email
                            Address') }}</label>
                        <input type="email"
                            class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            id="donor_email" name="donor_email" placeholder="name@example.com">
                    </div>

                    <div class="col-span-2">
                        <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Address Line 1') }}
                            <span class="text-red-500">*</span></label>
                        <input type="text"
                            class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            name="address_line1" required>
                    </div>

                    <div class="col-span-2">
                        <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Address Line 2')
                            }}</label>
                        <input type="text"
                            class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            name="address_line2" placeholder="{{ _('Apartment, Studio, or Floor') }}">
                    </div>

                    <div class="col-span-1">
                        <label for="state" class="block text-sm font-semibold text-slate-700 mb-1">{{ _('State /
                            UT') }} <span class="text-red-500">*</span></label>
                        <select
                            class="form-select w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            id="state" name="state" required>
                            <option value="">{{ _('Select State') }}</option>
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <!-- ... (Shortened for brevity, use same list) ... -->
                            <option value="Delhi">Delhi</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <!-- Keeping same options as original -->
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="col-span-1">
                        <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('City') }} <span
                                class="text-red-500">*</span></label>
                        <input type="text"
                            class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            name="city" required>
                    </div>

                    <div class="col-span-1">
                        <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('District') }}</label>
                        <input type="text"
                            class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            name="district">
                    </div>

                    <div class="col-span-1 md:col-span-1">
                        <!-- Using grid gap to align -->
                        <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Pincode') }} <span
                                class="text-red-500">*</span></label>
                        <input type="text"
                            class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            name="pincode" pattern="[0-9]{6}" placeholder="{{ _('6-digit code') }}" required>
                    </div>
                </div>

                <div class="mt-8 flex justify-between">
                    <button type="button"
                        class="btn-prev px-6 py-2.5 border border-slate-300 text-slate-600 font-semibold rounded-xl hover:bg-slate-50 transition-all inline-flex items-center gap-2">
                        <i class="bi bi-arrow-left"></i> {{ _('Previous') }}
                    </button>
                    <button type="button"
                        class="btn-next px-6 py-2.5 bg-brand-600 hover:bg-brand-700 text-white font-semibold rounded-xl shadow-lg shadow-brand-500/30 transition-all inline-flex items-center gap-2">
                        {{ _('Next Step') }} <i class="bi bi-arrow-right"></i>
                    </button>
                </div>
        </div>

        <!-- STEP 3: Witness (Next of Kin) -->
        <div class="form-step hidden animation-fade-up" data-step-index="3">
            <h4 class="text-lg font-bold text-brand-600 mb-6 flex items-center gap-2">
                <span
                    class="w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center text-brand-600 text-sm">3</span>
                {{ _('Next of Kin / Witness') }}
            </h4>

            <div class="p-4 rounded-xl bg-blue-50 border border-blue-100 text-blue-800 text-sm mb-6 flex gap-3">
                <i class="bi bi-info-circle-fill mt-0.5 shrink-0"></i>
                {{ _('A witness (preferably next of kin) is mandatory for the pledge to be registered.') }}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="col-span-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Witness Name') }} <span
                            class="text-red-500">*</span></label>
                    <input type="text"
                        class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="witness1_name" required>
                </div>
                <div class="col-span-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Relationship') }} <span
                            class="text-red-500">*</span></label>
                    <select
                        class="form-select w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="witness1_relationship" required>
                        <option value="">{{ _('Select Relationship') }}</option>
                        <option value="Father">{{ _('Father') }}</option>
                        <option value="Mother">{{ _('Mother') }}</option>
                        <option value="Spouse">{{ _('Spouse') }}</option>
                        <option value="Child">{{ _('Child') }}</option>
                        <option value="Sibling">{{ _('Sibling') }}</option>
                        <option value="Friend">{{ _('Friend') }}</option>
                        <option value="Other">{{ _('Other') }}</option>
                    </select>
                </div>
                <div class="col-span-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Witness Mobile') }}
                        <span class="text-red-500">*</span></label>
                    <div class="flex rounded-xl shadow-sm">
                        <span
                            class="inline-flex items-center px-3 rounded-l-xl border border-r-0 border-slate-300 bg-slate-50 text-slate-500 text-sm">+91</span>
                        <input type="tel"
                            class="form-input flex-1 block w-full rounded-none rounded-r-xl border-slate-300 focus:border-brand-500 focus:ring-brand-500"
                            name="witness1_mobile" pattern="[0-9]{10}" required>
                    </div>
                </div>
                <div class="col-span-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Witness Email')
                        }}</label>
                    <input type="email"
                        class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="witness1_email">
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Witness Address')
                        }}</label>
                    <textarea
                        class="form-textarea w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="witness1_address" rows="2"></textarea>
                </div>
            </div>

            <div class="border-t border-slate-200 my-8"></div>

            <h5 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">{{ _('Second Witness
                (Optional)') }}</h5>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 opacity-80 hover:opacity-100 transition-opacity">
                <!-- Same structure as witness 1 but optional -->
                <div class="col-span-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Witness Name')
                        }}</label>
                    <input type="text"
                        class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="witness2_name">
                </div>
                <div class="col-span-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Relationship')
                        }}</label>
                    <select
                        class="form-select w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="witness2_relationship">
                        <option value="">{{ _('Select Relationship') }}</option>
                        <option value="Father">{{ _('Father') }}</option>
                        <!-- ... -->
                        <option value="Other">{{ _('Other') }}</option>
                    </select>
                </div>
                <div class="col-span-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Witness Mobile')
                        }}</label>
                    <div class="flex rounded-xl shadow-sm">
                        <span
                            class="inline-flex items-center px-3 rounded-l-xl border border-r-0 border-slate-300 bg-slate-50 text-slate-500 text-sm">+91</span>
                        <input type="tel"
                            class="form-input flex-1 block w-full rounded-none rounded-r-xl border-slate-300 focus:border-brand-500 focus:ring-brand-500"
                            name="witness2_mobile" pattern="[0-9]{10}">
                    </div>
                </div>
                <div class="col-span-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Witness Email')
                        }}</label>
                    <input type="email"
                        class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="witness2_email">
                </div>
                <div class="col-span-2">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Witness Address')
                        }}</label>
                    <textarea
                        class="form-textarea w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="witness2_address" rows="1"></textarea>
                </div>
            </div>

            <div class="mt-8 flex justify-between">
                <button type="button"
                    class="btn-prev px-6 py-2.5 border border-slate-300 text-slate-600 font-semibold rounded-xl hover:bg-slate-50 transition-all inline-flex items-center gap-2">
                    <i class="bi bi-arrow-left"></i> {{ _('Previous') }}
                </button>
                <button type="button"
                    class="btn-next px-6 py-2.5 bg-brand-600 hover:bg-brand-700 text-white font-semibold rounded-xl shadow-lg shadow-brand-500/30 transition-all inline-flex items-center gap-2">
                    {{ _('Next Step') }} <i class="bi bi-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- STEP 4: Pledge & Consent -->
        <div class="form-step hidden animation-fade-up" data-step-index="4">
            <h4 class="text-lg font-bold text-brand-600 mb-6 flex items-center gap-2">
                <span
                    class="w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center text-brand-600 text-sm">4</span>
                {{ _('Final Consent') }}
            </h4>

            <div class="bg-slate-50 border border-slate-200 rounded-xl p-6 mb-6">
                <h5 class="text-lg font-bold text-slate-900 mb-4">{{ _('My Wish') }}</h5>

                <div class="mb-4">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('I wish to donate:')
                        }}</label>
                    <select
                        class="form-select w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="organs_consented">
                        <option value="Both eyes" selected>{{ _('Both Eyes (Recommended)') }}</option>
                        <option value="Cornea only">{{ _('Corneas Only') }}</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Place of Pledge')
                            }}</label>
                        <input type="text"
                            class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            name="place" placeholder="e.g. Mumbai">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Preferred Eye Bank
                            (Optional)') }}</label>
                        <input type="text"
                            class="form-input w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                            name="preferred_eye_bank">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{{ _('Additional Notes')
                        }}</label>
                    <textarea
                        class="form-textarea w-full rounded-xl border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"
                        name="additional_notes" rows="2"></textarea>
                </div>

                <p class="text-xs text-slate-500 italic mt-2">
                    {{ _('By submitting this form, I hereby pledge to donate my eyes after my death...') }}
                    {{ _('I understand my family will be the final authority...') }}
                </p>
            </div>

            <div class="space-y-4 mb-8">
                <div class="flex items-start gap-3">
                    <input type="checkbox"
                        class="form-checkbox mt-1 w-5 h-5 text-brand-600 rounded border-slate-300 focus:ring-brand-500"
                        id="consent_check" name="donor_consent" required>
                    <label class="text-sm text-slate-700 font-bold" for="consent_check">
                        {{ _('I solemnly Pledge to donate my eyes.') }} <span class="text-red-500">*</span>
                    </label>
                </div>

                <div class="flex items-start gap-3">
                    <input type="checkbox"
                        class="form-checkbox mt-1 w-5 h-5 text-brand-600 rounded border-slate-300 focus:ring-brand-500"
                        name="acknowledged_revocability" checked>
                    <label class="text-sm text-slate-600">
                        {{ _('I understand this pledge is voluntary and can be revoked at any time.') }}
                    </label>
                </div>

                <div class="flex items-start gap-3">
                    <input type="checkbox"
                        class="form-checkbox mt-1 w-5 h-5 text-brand-600 rounded border-slate-300 focus:ring-brand-500"
                        id="dpdp_consent" name="dpdp_consent" required>
                    <label class="text-sm text-slate-600" for="dpdp_consent">
                        {{ _('I consent to the collection and processing of my personal data...') }} <span
                            class="text-red-500">*</span>
                    </label>
                </div>
            </div>

            <!-- Hidden Date Field -->
            <input type="hidden" name="date_of_pledge" id="date_of_pledge">

            <div class="flex justify-between items-center">
                <button type="button"
                    class="btn-prev px-6 py-2.5 border border-slate-300 text-slate-600 font-semibold rounded-xl hover:bg-slate-50 transition-all inline-flex items-center gap-2">
                    <i class="bi bi-arrow-left"></i> {{ _('Previous') }}
                </button>
                <button type="submit"
                    class="px-8 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl shadow-lg shadow-green-600/30 transition-all transform hover:-translate-y-0.5 inline-flex items-center gap-2">
                    <i class="bi bi-heart-fill"></i> {{ _('Confirm Pledge') }}
                </button>
            </div>
        </div>
        </form>
    </div>
</div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const steps = document.querySelectorAll('.form-step');
        const indicators = document.querySelectorAll('.step-item');
        let currentStep = 0;

        // Init visibility
        updateUI();

        // Set today's date
        document.getElementById('date_of_pledge').value = new Date().toISOString().split('T')[0];

        // Age Calculation
        const dobInput = document.getElementById('date_of_birth');
        const ageInput = document.getElementById('age');
        dobInput.addEventListener('change', function () {
            if (this.value) {
                const dob = new Date(this.value);
                const today = new Date();
                let age = today.getFullYear() - dob.getFullYear();
                const m = today.getMonth() - dob.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                    age--;
                }
                ageInput.value = age;
            }
        });

        // Validations
        function validateStep(index) {
            const step = steps[index];
            const inputs = step.querySelectorAll('input[required], select[required]');
            let valid = true;

            inputs.forEach(input => {
                const msg = input.parentElement.querySelector('.validation-msg') || input.parentElement.parentElement.querySelector('.validation-msg');

                if (!input.checkValidity()) {
                    input.reportValidity();
                    valid = false;
                    // Tailwind error styling
                    input.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                    if (msg) msg.classList.remove('hidden');
                } else {
                    input.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                    if (msg) msg.classList.add('hidden');
                }
            });
            return valid;
        }

        // Navigation
        document.querySelectorAll('.btn-next').forEach(btn => {
            btn.addEventListener('click', () => {
                if (validateStep(currentStep)) {
                    if (currentStep < steps.length - 1) {
                        currentStep++;
                        updateUI();
                    }
                }
            });
        });

        document.querySelectorAll('.btn-prev').forEach(btn => {
            btn.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    updateUI();
                }
            });
        });

        function updateUI() {
            // Update Steps Visibility
            steps.forEach((step, idx) => {
                if (idx === currentStep) {
                    step.classList.remove('hidden');
                } else {
                    step.classList.add('hidden');
                }
            });

            // Update Indicators
            indicators.forEach((ind, idx) => {
                // Reset classes
                ind.className = 'step-item relative z-10 w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm transition-all duration-300 border-2';

                if (idx === currentStep) {
                    // Active (Brand Blue)
                    ind.classList.add('bg-brand-600', 'border-brand-600', 'text-white', 'shadow-[0_0_0_4px_rgba(37,99,235,0.2)]');
                    ind.innerHTML = idx + 1;
                } else if (idx < currentStep) {
                    // Completed (Green)
                    ind.classList.add('bg-green-500', 'border-green-500', 'text-white');
                    ind.innerHTML = '<i class="bi bi-check-lg"></i>';
                } else {
                    // Inactive (Gray)
                    ind.classList.add('bg-slate-50', 'border-slate-200', 'text-slate-400');
                    ind.innerHTML = idx + 1;
                }
            });

            // Scroll to top of form
            const formContainer = document.querySelector('.max-w-4xl');
            if (formContainer) {
                const y = formContainer.getBoundingClientRect().top + window.scrollY - 100;
                window.scrollTo({ top: y, behavior: 'smooth' });
            }
        }

    });
</script>
{% endblock %}