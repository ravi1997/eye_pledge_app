{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container-main">
        <h1>Admin Dashboard</h1>
        <p class="subtitle">Eye Donation Pledge Management System</p>
    </div>
</div>

<div class="container-main">
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="form-section text-center">
                <h5 class="text-muted mb-2">Total Pledges</h5>
                <h2 style="color: #0066cc; font-weight: 700;">{{ total_pledges }}</h2>
            </div>
        </div>


    </div>

    <!-- Action Cards -->
    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            <div class="form-section">
                <h5><i class="bi bi-list-check"></i> Manage Pledges</h5>
                <p class="mb-3">View, search, filter, and manage all pledges in the system.</p>
                <a href="{{ url_for('admin_pledges') }}" class="btn btn-primary">
                    <i class="bi bi-arrow-right"></i> View All Pledges
                </a>
            </div>
        </div>

        <div class="col-md-6 mb-3">
            <div class="form-section">
                <h5><i class="bi bi-download"></i> Export Data</h5>
                <p class="mb-3">Export filtered pledge records as CSV for analysis.</p>
                <a href="{{ url_for('admin_export') }}" class="btn btn-primary">
                    <i class="bi bi-download"></i> Export as CSV
                </a>
            </div>
        </div>

        <div class="col-md-6 mb-3">
            <div class="form-section">
                <h5><i class="bi bi-journal-text"></i> System Logs</h5>
                <p class="mb-3">View comprehensive system logs (Access, Security, Error).</p>
                <a href="{{ url_for('admin_logs') }}" class="btn btn-secondary">
                    <i class="bi bi-eye"></i> View System Logs
                </a>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row">
        <div class="col-md-8 mb-4">
            <div class="form-section">
                <h5 class="mb-3"><i class="bi bi-bar-chart"></i> Pledges by Month (Current Year)</h5>
                {% if monthly_stats %}
                <div style="overflow-x: auto;">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for month, count in monthly_stats %}
                            <tr>
                                <td>{% if month == '01' %}January{% elif month == '02' %}February{% elif month == '03'
                                    %}March{% elif month == '04' %}April{% elif month == '05' %}May{% elif month == '06'
                                    %}June{% elif month == '07' %}July{% elif month == '08' %}August{% elif month ==
                                    '09' %}September{% elif month == '10' %}October{% elif month == '11' %}November{%
                                    elif month == '12' %}December{% endif %}</td>
                                <td><span class="badge bg-primary">{{ count }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">No pledges recorded this year yet.</p>
                {% endif %}
            </div>
        </div>

        <div class="col-md-4 mb-4">
            <div class="form-section">
                <h5 class="mb-3"><i class="bi bi-geo-alt"></i> Top States</h5>
                {% if pledges_by_state %}
                <ul class="list-group list-group-flush">
                    {% for state, count in pledges_by_state %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ state }}
                        <span class="badge bg-primary rounded-pill">{{ count }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted mb-0">No state data available.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="form-section mt-4">
        <h5 class="mb-3">Quick Links</h5>
        <div class="btn-group btn-group-sm" role="group">
            <a href="{{ url_for('admin_pledges') }}" class="btn btn-outline-primary">All Pledges</a>

            <a href="{{ url_for('admin_logs') }}" class="btn btn-outline-secondary">Logs</a>
            <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-danger ms-2">Logout</a>
        </div>
    </div>
</div>
{% endblock %}